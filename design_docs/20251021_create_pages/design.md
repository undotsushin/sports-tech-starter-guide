# 設計書：新卒向け研修資料サイト

## 1. システムアーキテクチャ

### 1.1 技術スタック（2025年10月最新版）

```
┌─────────────────────────────────────┐
│   GitHub Pages (Hosting)            │
│   https://<username>.github.io/     │
└─────────────────────────────────────┘
                 ↑
                 │ Deploy (GitHub Actions)
                 │
┌─────────────────────────────────────┐
│   Static Site (HTML/CSS/JS)         │
│   Generated by Next.js              │
└─────────────────────────────────────┘
                 ↑
                 │ Build (next build + next export)
                 │
┌─────────────────────────────────────┐
│   Next.js 15.5.6 (App Router)       │
│   - React 19.2 (stable)             │
│   - TypeScript 5.7+                 │
│   - @next/mdx 15.5.6                │
│   - Tailwind CSS v4.0               │
└─────────────────────────────────────┘
                 ↑
                 │ Content Source
                 │
┌─────────────────────────────────────┐
│   MDX Files (.mdx)                  │
│   /src/content/                     │
│   - 01-web-structure.mdx            │
│   - 02-web-tech.mdx                 │
│   - ...                             │
└─────────────────────────────────────┘
```

**最新バージョン（2025年10月現在）**:
- **Next.js**: 15.5.6（2025年8月リリース、Turbopack安定版）
- **React**: 19.2（2025年10月リリース、React Compiler内蔵）
- **TypeScript**: 5.7+
- **@next/mdx**: 15.5.6（next-mdx-remoteは非推奨）
- **Tailwind CSS**: v4.0（完全リライト、5-100倍高速化）

### 1.2 選定理由

**Next.js 15.5 + @next/mdx**
- ✅ ユーザーがNext.jsに慣れている
- ✅ TypeScriptで型安全な開発が可能
- ✅ **Turbopack安定版**で超高速ビルド（Vercelの本番環境で12億リクエスト処理実績）
- ✅ **@next/mdx**は公式推奨（next-mdx-remoteは2025年時点で非推奨）
- ✅ MDXでマークダウン内にReactコンポーネントを埋め込める（クイズ機能）
- ✅ Server Componentsでクライアントバンドル削減
- ✅ 静的サイト生成（SSG）でGitHub Pages対応

**React 19.2**
- ✅ **React Compiler内蔵**（useMemo/useCallback不要、自動最適化）
- ✅ **Actions API**で非同期処理が簡単
- ✅ Server Components完全安定版

**Tailwind CSS v4.0**
- ✅ **5-100倍高速化**（マイクロ秒単位のインクリメンタルビルド）
- ✅ **CSS-First設定**（JavaScriptではなくCSSで設定）
- ✅ **P3カラーパレット**対応（鮮やかなディスプレイ最適化）
- ✅ ゼロコンフィグ、自動テンプレート検出
- ✅ Next.js 15との完全互換性

## 2. ディレクトリ構成

```
sports-tech-starter-guide/
├── .github/
│   └── workflows/
│       └── deploy.yml              # GitHub Actions（自動デプロイ）
├── content/                        # 📝 コンテンツ（非エンジニアもここだけ編集）
│   ├── README.md                   # コンテンツ編集ガイド
│   ├── 01-web-structure.mdx        # Webサイト構造とパーツ集
│   ├── 02-web-tech.mdx             # Web技術基礎
│   ├── 03-app-basics.mdx           # アプリ基礎知識
│   ├── 04-ad-marketing.mdx         # 広告・マーケティング技術
│   ├── 05-security.mdx             # セキュリティ基礎
│   ├── 06-practical.mdx            # 実践シチュエーション集
│   ├── 07-ai-usage.mdx             # AI活用実践編
│   ├── 08-markdown.mdx             # マークダウン記法
│   └── 09-final-test.mdx           # 総合テスト集
├── src/
│   ├── app/
│   │   ├── layout.tsx              # ルートレイアウト
│   │   ├── page.tsx                # トップページ（目次）
│   │   ├── [slug]/
│   │   │   └── page.tsx            # 動的ページ（各章）
│   │   └── test/
│   │       └── page.tsx            # 総合テストページ
│   ├── components/
│   │   ├── Layout/
│   │   │   ├── Header.tsx          # ヘッダー
│   │   │   ├── Sidebar.tsx         # サイドバーナビ
│   │   │   └── Footer.tsx          # フッター
│   │   ├── MDX/
│   │   │   ├── MDXComponents.tsx   # MDX用カスタムコンポーネント
│   │   │   ├── Quiz.tsx            # クイズコンポーネント
│   │   │   ├── CodeBlock.tsx       # コードブロック（シンタックスハイライト）
│   │   │   └── Callout.tsx         # 注意書きボックス
│   │   ├── Progress/
│   │   │   ├── ProgressBar.tsx     # 進捗バー
│   │   │   └── ProgressTracker.tsx # 進捗管理
│   │   └── Navigation/
│   │       └── Breadcrumb.tsx      # パンくずリスト
│   ├── lib/
│   │   ├── mdx.ts                  # MDXファイル読み込み
│   │   ├── content.ts              # コンテンツメタデータ管理
│   │   └── progress.ts             # 進捗管理ロジック（LocalStorage）
│   ├── types/
│   │   └── index.ts                # 型定義
│   └── styles/
│       └── globals.css             # グローバルスタイル
├── public/
│   ├── images/                     # 画像ファイル
│   └── .nojekyll                   # GitHub Pages用（Jekyllを無効化）
├── next.config.mjs                 # Next.js設定（static export）
├── tsconfig.json                   # TypeScript設定
├── package.json
└── README.md
```

**重要な変更点**:
- ✅ `content/` をプロジェクトルート直下に配置
- ✅ `content/README.md` で非エンジニア向けの編集ガイドを用意
- ✅ `.github/workflows/deploy.yml` をコードで実装（SSGのビルド環境）

## 3. データモデル

### 3.1 Content Metadata

```typescript
// src/types/index.ts

export interface ContentMetadata {
  slug: string;              // URL用スラグ（例: "01-web-structure"）
  title: string;             // タイトル（例: "Webサイト構造とパーツ集"）
  description: string;       // 説明
  order: number;             // 順序（1, 2, 3...）
  icon?: string;             // アイコン絵文字（オプション）
  estimatedTime: number;     // 推定学習時間（分）
}

export interface Quiz {
  id: string;
  question: string;
  options: string[];
  correctAnswer: number;     // 正解のインデックス
  explanation?: string;      // 解説（オプション）
}

export interface Progress {
  [slug: string]: {
    completed: boolean;
    quizScore?: number;      // クイズの正答率
    lastVisited: Date;
  };
}
```

### 3.2 LocalStorage Schema

```typescript
// ブラウザのLocalStorageに保存
{
  "training-progress": {
    "01-web-structure": {
      "completed": true,
      "quizScore": 100,
      "lastVisited": "2025-10-21T12:00:00Z"
    },
    "02-web-tech": {
      "completed": false,
      "lastVisited": "2025-10-21T13:00:00Z"
    },
    // ...
  }
}
```

## 4. コンポーネント設計

### 4.1 Layout Components

#### Header.tsx
```tsx
// グローバルヘッダー
- ロゴ（運動通信社）
- タイトル（IT基礎知識ハンドブック）
- ダークモード切り替えボタン（オプション）
- 進捗インジケーター（X / 9 完了）
```

#### Sidebar.tsx
```tsx
// サイドバーナビゲーション
- 全セクションのリスト
- 完了済みセクションにチェックマーク
- 現在のセクションをハイライト
- スマホではハンバーガーメニュー
```

#### Footer.tsx
```tsx
// フッター
- 著作権表記
- GitHubリポジトリへのリンク
- 最終更新日
```

### 4.2 MDX Components

#### Quiz.tsx
```tsx
// クイズコンポーネント
interface QuizProps {
  question: string;
  options: string[];
  correctAnswer: number;
  explanation?: string;
}

// 機能:
// - ラジオボタンで選択肢を表示
// - 「回答する」ボタン
// - 正解/不正解のフィードバック
// - 解説の表示
// - 結果をLocalStorageに保存
```

#### CodeBlock.tsx
```tsx
// コードブロック（シンタックスハイライト）
// ライブラリ: react-syntax-highlighter
// - 言語自動検出
// - コピーボタン
// - 行番号表示
```

#### Callout.tsx
```tsx
// 注意書きボックス
interface CalloutProps {
  type: 'info' | 'warning' | 'success' | 'error';
  title?: string;
  children: React.ReactNode;
}

// 例:
// <Callout type="info" title="ポイント">
//   ここは重要な情報です
// </Callout>
```

### 4.3 Progress Components

#### ProgressBar.tsx
```tsx
// 進捗バー
interface ProgressBarProps {
  current: number;  // 完了数
  total: number;    // 全体数
}

// - 視覚的な進捗バー
// - パーセンテージ表示
// - アニメーション
```

#### ProgressTracker.tsx
```tsx
// 進捗管理（LocalStorageとのやり取り）
// - 現在のページを完了としてマーク
// - 進捗データの取得
// - 進捗データのリセット機能
```

## 5. ページ構成

### 5.1 トップページ（/）

```tsx
// src/app/page.tsx

機能:
- サイトの説明
- 全9セクションのカード一覧
- 各カードに:
  - タイトル
  - 説明
  - 推定学習時間
  - 完了状態（チェックマーク）
  - 「学習を開始」ボタン
- 総合テストへのリンク
- 全体の進捗バー
```

### 5.2 コンテンツページ（/[slug]）

```tsx
// src/app/[slug]/page.tsx

機能:
- 動的ルーティング（例: /01-web-structure）
- MDXコンテンツのレンダリング
- パンくずリスト
- 前後ページへのナビゲーション
- サイドバーナビゲーション
- 各セクション内のクイズ
- 「完了」ボタン（進捗を保存）
```

### 5.3 総合テストページ（/test）

```tsx
// src/app/test/page.tsx

機能:
- 基礎知識確認テスト（30問）
- 実践問題（ケーススタディ）
- PMレベル実力診断テスト
- スコアの記録
- 合格/不合格の判定
- 弱点セクションの提案
```

## 6. 実装詳細

### 6.1 MDXファイルの読み込み（@next/mdx使用）

```typescript
// src/lib/mdx.ts

import fs from 'fs';
import path from 'path';
import matter from 'gray-matter';

export async function getContentBySlug(slug: string) {
  // contentディレクトリはプロジェクトルート直下
  const filePath = path.join(process.cwd(), 'content', `${slug}.mdx`);
  const source = fs.readFileSync(filePath, 'utf-8');

  // frontmatter解析
  const { data, content } = matter(source);

  return {
    frontmatter: data,
    content,
    slug
  };
}

export function getAllContentSlugs() {
  // contentディレクトリはプロジェクトルート直下
  const contentDir = path.join(process.cwd(), 'content');
  const files = fs.readdirSync(contentDir);
  return files
    .filter(file => file.endsWith('.mdx'))
    .map(file => file.replace('.mdx', ''));
}

export async function getAllContents() {
  const slugs = getAllContentSlugs();
  const contents = await Promise.all(
    slugs.map(slug => getContentBySlug(slug))
  );
  return contents.sort((a, b) =>
    a.frontmatter.order - b.frontmatter.order
  );
}
```

```typescript
// src/app/[slug]/page.tsx

import { getContentBySlug, getAllContentSlugs } from '@/lib/mdx';
import { MDXComponents } from '@/components/MDX/MDXComponents';

// 動的ルーティングで使用するパスを生成
export async function generateStaticParams() {
  const slugs = getAllContentSlugs();
  return slugs.map(slug => ({ slug }));
}

export default async function ContentPage({
  params
}: {
  params: { slug: string }
}) {
  const { frontmatter, slug } = await getContentBySlug(params.slug);

  // @next/mdxを使用してMDXファイルを動的インポート
  // contentディレクトリはプロジェクトルート直下
  const MDXContent = (await import(`@/../content/${slug}.mdx`)).default;

  return (
    <article>
      <h1>{frontmatter.title}</h1>
      <MDXContent components={MDXComponents} />
    </article>
  );
}
```

### 6.2 静的サイト生成設定（Next.js 15 + @next/mdx）

```javascript
// next.config.mjs

import createMDX from '@next/mdx';
import remarkGfm from 'remark-gfm';
import rehypePrism from 'rehype-prism-plus';

/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export',  // 静的エクスポート
  basePath: process.env.NODE_ENV === 'production' ? '/sports-tech-starter-guide' : '',
  images: {
    unoptimized: true,  // GitHub Pagesでは画像最適化API使えない
  },
  trailingSlash: true,  // GitHub Pages用
  pageExtensions: ['js', 'jsx', 'md', 'mdx', 'ts', 'tsx'],
  experimental: {
    turbo: {}, // Turbopack有効化（Next.js 15で安定版）
  },
};

const withMDX = createMDX({
  extension: /\.mdx?$/,
  options: {
    remarkPlugins: [remarkGfm], // GitHubスタイルMarkdown
    rehypePlugins: [rehypePrism], // シンタックスハイライト
  },
});

export default withMDX(nextConfig);
```

```json
// package.json（最新版）

{
  "name": "sports-tech-starter-guide",
  "version": "1.0.0",
  "scripts": {
    "dev": "next dev --turbo",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "next": "^15.5.6",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "@next/mdx": "^15.5.6",
    "gray-matter": "^4.0.3",
    "remark-gfm": "^4.0.0",
    "rehype-prism-plus": "^2.0.0"
  },
  "devDependencies": {
    "typescript": "^5.7.0",
    "@types/node": "^22",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "tailwindcss": "^4.0.0",
    "postcss": "^8",
    "autoprefixer": "^10"
  }
}
```

### 6.3 GitHub Pagesへのデプロイ（GitHub Actions）

**SSGなので、ビルド環境が必要です：**
- マークダウン → HTML/CSS/JS に変換する処理
- この変換を GitHub Actions で自動実行します

**`.github/workflows/deploy.yml`**（コードで実装）:

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build with Next.js
        run: npm run build
        env:
          NODE_ENV: production

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./out

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

**動作フロー**:
```
1. 非エンジニアがcontent/のマークダウンを編集
2. GitHub にpush
3. GitHub Actions が自動でビルド（SSG）
4. HTML/CSS/JS に変換
5. GitHub Pages で公開
```

**GitHubリポジトリ設定**（初回のみ）:
1. Settings > Pages
2. Source: **"GitHub Actions"** を選択

**メリット**:
- ✅ mainブランチへのpushで自動デプロイ
- ✅ ビルドエラーをGitHub上で確認できる
- ✅ 非エンジニアもマークダウン編集だけで公開可能
- ✅ Node.jsの環境がローカルになくてもOK

## 7. スタイリング方針

### 7.1 デザインシステム（Tailwind CSS v4.0）

```css
/* src/app/globals.css - Tailwind v4.0のCSS-First設定 */

@import "tailwindcss";

/* カスタムカラー（CSS変数で定義） */
@theme {
  --color-primary-50: #f0f9ff;
  --color-primary-500: #0ea5e9;
  --color-primary-700: #0369a1;
  --color-success: #22c55e;
  --color-warning: #f59e0b;
  --color-error: #ef4444;

  /* P3カラースペース対応（鮮やかなディスプレイ用） */
  @supports (color: color(display-p3 1 1 1)) {
    --color-primary-500: color(display-p3 0.05 0.65 0.91);
  }

  /* フォント */
  --font-family-sans: Inter, "Noto Sans JP", system-ui, sans-serif;
  --font-family-mono: "Fira Code", "SF Mono", monospace;
}
```

**Tailwind v4.0の新機能**:
- ✅ CSS変数で直接設定（JavaScriptファイル不要）
- ✅ P3カラースペース対応
- ✅ 自動テンプレート検出（設定不要）
- ✅ ゼロコンフィグ

### 7.2 レスポンシブブレークポイント

```css
/* Tailwind デフォルト */
sm: 640px   /* スマホ横 */
md: 768px   /* タブレット */
lg: 1024px  /* ノートPC */
xl: 1280px  /* デスクトップ */
```

### 7.3 コンポーネントスタイル例

```tsx
// カード
<div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 hover:shadow-lg transition">
  {/* コンテンツ */}
</div>

// ボタン
<button className="bg-primary-500 text-white px-4 py-2 rounded-md hover:bg-primary-700 transition">
  開始
</button>

// クイズ正解
<div className="bg-success/10 border border-success text-success-700 p-4 rounded-md">
  正解です！
</div>
```

## 8. パフォーマンス最適化

### 8.1 コード分割
- 各ページは動的ルーティングで自動分割
- クイズコンポーネントは遅延ロード可能

### 8.2 画像最適化
- WebP形式を優先
- 適切なサイズで配信
- 遅延ロード（loading="lazy"）

### 8.3 バンドルサイズ削減
- Tree shaking
- 不要な依存関係を除外
- 必要最小限のライブラリ

## 9. セキュリティ考慮事項

### 9.1 公開リポジトリの安全性

**このプロジェクトは公開リポジトリです。以下の設計により安全性を担保：**

#### アーキテクチャレベルの安全性
- ✅ 完全な静的サイト（SSG）、サーバーサイド処理なし
- ✅ 環境変数不要（`.env` ファイル不要）
- ✅ APIキー不要（外部API使用なし）
- ✅ データベース不要（接続情報なし）
- ✅ 認証機能なし（トークン・パスワード不要）
- ✅ シークレット情報を含まない設計

#### データの安全性
- ✅ 教育コンテンツのみ（公開可能）
- ✅ 個人情報を扱わない
- ✅ LocalStorageは学習進捗のみ（ユーザー識別情報なし）

### 9.2 .gitignore 設定

**`.gitignore`**（必須）:

```gitignore
# 環境変数（念のため）
.env
.env.local
.env.production
.env.*.local

# ビルド成果物
/out
/.next
/build

# 依存関係
/node_modules

# エディタ設定（個人設定が含まれる可能性）
.vscode/settings.json
.idea/
*.swp
*.swo

# macOS
.DS_Store
.AppleDouble
.LSOverride

# Windows
Thumbs.db
ehthumbs.db

# ログファイル
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# 一時ファイル
*.tmp
*.temp
```

### 9.3 README.md セキュリティ注意事項

**README.mdに以下を記載**:

```markdown
## ⚠️ セキュリティ注意事項

このリポジトリは**公開リポジトリ**です。

### コミットしてはいけないもの

❌ **絶対にコミットしないでください**:
- 個人情報（氏名、メールアドレス、電話番号など）
- 社内機密情報（未発表の情報、内部資料など）
- APIキー、パスワード、トークン
- 環境変数ファイル（.env）
- 秘密鍵、証明書

✅ **コミットして良いもの**:
- 教育コンテンツ（マークダウン）
- 公開可能なコード
- 設定ファイル（機密情報を含まない）
- ドキュメント

### 誤ってコミットしてしまった場合

1. **即座に対応が必要です**
2. Git履歴から完全に削除する必要があります
3. 開発チームに連絡してください
4. 必要に応じてAPIキーやパスワードを無効化してください
```

### 9.4 プルリクエストレビューチェックリスト

**PRテンプレート**（`.github/pull_request_template.md`）:

```markdown
## 変更内容

<!-- 変更内容を簡潔に記載 -->

## セキュリティチェック

PRを作成する前に、以下を確認してください：

- [ ] 個人情報が含まれていないか
- [ ] 社内機密情報が含まれていないか
- [ ] APIキーやパスワードが含まれていないか
- [ ] 環境変数ファイル（.env）が含まれていないか
- [ ] コンテンツが公開可能なものか
- [ ] `.gitignore` が適切に設定されているか

## テスト

- [ ] ローカルでビルドが成功する（`npm run build`）
- [ ] 変更内容を確認した
```

### 9.5 XSS対策
- Reactの自動エスケープ
- MDXコンパイラのサニタイゼーション
- ユーザー入力を受け付けない設計

### 9.6 HTTPS
- GitHub Pagesがデフォルトで提供
- 証明書の管理不要

### 9.7 定期的なセキュリティチェック

**実施すべきこと**:
1. 依存関係の脆弱性チェック
   ```bash
   npm audit
   npm audit fix
   ```

2. GitHub Dependabotの有効化
   - Settings > Security > Dependabot alerts を有効化
   - 自動で脆弱性を検出・通知

3. コミット履歴の確認
   - 誤って機密情報がコミットされていないか定期的に確認

## 10. 今後の拡張性

### 10.1 Phase 2（将来的な機能）
- [ ] 検索機能（Algolia DocSearchまたはローカル検索）
- [ ] ダークモード
- [ ] 印刷用CSS
- [ ] オフライン対応（PWA）

### 10.2 Phase 3（高度な機能）
- [ ] GitHub Discussions連携（質問・コメント）
- [ ] 学習時間トラッキング
- [ ] 修了証の発行
- [ ] 管理者ダッシュボード（Google Sheetsなど）

## 11. 技術的課題と解決策

### 課題1: Next.jsの動的機能制限
**解決**:
- `output: 'export'`で静的エクスポート
- サーバー側機能（API Routes、Server Actions）は使用しない
- クライアント側のみで完結

### 課題2: 進捗データの永続化
**解決**:
- LocalStorageを使用
- 将来的にはGitHub Gist APIで同期も検討可能

### 課題3: コンテンツ量が多い
**解決**:
- ページ分割（1セクション = 1ページ）
- 遅延ロード
- コード分割

## 12. テスト戦略

### 12.1 単体テスト
- Vitest + React Testing Library
- コンポーネントのテスト（Quiz、Progress等）

### 12.2 E2Eテスト
- Playwright（オプション）
- 主要フローのテスト（ページ遷移、クイズ回答など）

### 12.3 手動テスト
- [ ] デスクトップ（Chrome、Firefox、Safari）
- [ ] スマホ（iOS Safari、Android Chrome）
- [ ] タブレット
- [ ] 進捗保存・復元

## 13. リリースチェックリスト

- [ ] 全コンテンツが正しくレンダリングされる
- [ ] クイズが正常に動作する
- [ ] 進捗が保存・復元される
- [ ] レスポンシブデザインが機能する
- [ ] GitHub Pagesで正常に表示される
- [ ] SEO設定（meta tags、sitemap）
- [ ] パフォーマンス測定（Lighthouse）
- [ ] アクセシビリティチェック（axe）
